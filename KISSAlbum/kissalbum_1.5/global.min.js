jQuery(function(b){function d(c){f.pagewidth=c+20;b("#gh_content, #header, #container").width(f.pagewidth);b(".photo_window").width(f.pagewidth-74)}function a(c){b(".album").remove();b(".album_view").show();b.ajax({url:c,dataType:"json",error:function(){alert("User Date Error!");window.location.href="index.html"},success:l})}function q(c){b(".album_view").remove();b(".album").show();b.ajax({url:c,dataType:"json",error:function(){alert("Album Date Error!");window.location.href="index.html"},success:t})}
function n(c){b.ajax({url:"http://api.flickr.com/services/rest/?method=flickr.urls.lookupUser&api_key="+u+"&url=http%3A%2F%2Fwww.flickr.com%2Fphotos%2F"+c+"%2F&format=json&nojsoncallback=1",dataType:"json",error:function(){alert("User Date Error!");window.location.href="index.html"},success:function(b){var c=b.user.id;h=b.user.username._content;v="http://api.flickr.com/services/rest/?method=flickr.photosets.getList&api_key="+u+"&user_id="+c+"&format=json&nojsoncallback=1";a(v)}})}function l(c){var a,
e,i,d,k;switch(f.server){case "flickr":k=c.photosets.photoset.length;break;default:k=c.feed.entry.length,h=c.feed.author[0].name.$t}document.title=h+"'s Photo Album";b("#hd_title h1").text(h+"'s Photo Album");s=" &gt; "+g;b("#gh_tips p").append(s);if(k>0){b(".album_view").append('<ul class="album_list"></ul>');for(var j=0;j<k;j++){switch(f.server){case "flickr":a=c.photosets.photoset[j].id;e="http://farm"+c.photosets.photoset[j].farm+".static.flickr.com/"+c.photosets.photoset[j].server+"/"+c.photosets.photoset[j].primary+
"_"+c.photosets.photoset[j].secret+"_s.jpg";i=c.photosets.photoset[j].title._content;d=c.photosets.photoset[j].description._content;break;default:a=c.feed.entry[j].gphoto$id.$t,e=c.feed.entry[j].media$group.media$thumbnail[0].url,i=c.feed.entry[j].title.$t,d=c.feed.entry[j].summary.$t}w(a,e,i,d,j+1,k,o)}}}function w(b,a,e,i,d,k,j){var f=new Image;f.id=b;f.src=a;f.title=e;f.summary=i;f.num=k;f.complete?j.call(f):f.onload=function(){j.call(f)}}function o(){z++;z==1&&b(".album_view .loading").remove();
var c="";c+='<li class="album_item">';switch(f.server){case "flickr":c+='<a href="index.html?server=flickr&userid='+g+"&albumid="+this.id+'" title="'+this.summary+'">';break;default:c+='<a href="index.html?server=picasa&userid='+g+"&albumid="+this.id+'" title="'+this.summary+'">'}c+='<img src="'+this.src+'" alt="'+this.summary+'" />';this.title!=""&&(c+="<span>"+this.title+"</span>");c+="</a>";c+="</li>";b(".album_view .album_list").append(c)}function t(c){switch(f.server){case "flickr":h=c.photoset.ownername;
document.title=h+"'s Photo Album";b("#hd_title h1").text(h+"'s Photo Album");G(c.photoset.id,h);m=c.photoset.photo.length;if(m>0){b(".photo_window").html('<ul class="photo_bar"></ul>').children(".photo_bar").width(83*m);b(".photo_view").append('<a class="photo_prev" href="#" title="\u4e0a\u4e00\u5f20 \u5feb\u6377\u952e:[&quot;H&quot;]\u6216\u8005[&quot;&larr;&quot;]" hidefocus="true"></a><a class="photo_next" href="#" title="\u4e0b\u4e00\u5f20 \u5feb\u6377\u952e:[&quot;L&quot;]\u6216\u8005[&quot;&rarr;&quot;]" hidefocus="true"></a><ul class="photo_list"></ul>');
for(var a=0;a<m;a++){var e=c.photoset.photo[a].id;A==e&&(x=a+1);B("http://farm"+c.photoset.photo[a].farm+".static.flickr.com/"+c.photoset.photo[a].server+"/"+c.photoset.photo[a].id+"_"+c.photoset.photo[a].secret+"_s.jpg",c.photoset.photo[a].title,a+1,e,C);D("http://farm"+c.photoset.photo[a].farm+".static.flickr.com/"+c.photoset.photo[a].server+"/"+c.photoset.photo[a].id+"_"+c.photoset.photo[a].secret+"_z.jpg",c.photoset.photo[a].title,"",a+1,null,"auto","auto",E)}}break;default:if(h=c.feed.author[0].name.$t,
document.title=h+"'s Photo Album",b("#hd_title h1").text(h+"'s Photo Album"),c.feed.title.$t!=""&&(s=' &gt; <a href="index.html?userid='+g+'" title="'+h+"'s Album\">"+g+"</a> &gt; "+c.feed.title.$t,a="<h2>"+c.feed.title.$t+"</h2>",b("#gh_tips p").append(s),b(".album").prepend(a)),c.feed.subtitle.$t!=""&&b(".album_intro").html("<p>"+c.feed.subtitle.$t+"</p>"),m=c.feed.entry.length,m>0){b(".photo_window").html('<ul class="photo_bar"></ul>').children(".photo_bar").width(83*m);b(".photo_view").append('<a class="photo_prev" href="#" title="\u4e0a\u4e00\u5f20 \u5feb\u6377\u952e:[&quot;H&quot;]\u6216\u8005[&quot;&larr;&quot;]" hidefocus="true"></a><a class="photo_next" href="#" title="\u4e0b\u4e00\u5f20 \u5feb\u6377\u952e:[&quot;L&quot;]\u6216\u8005[&quot;&rarr;&quot;]" hidefocus="true"></a><ul class="photo_list"></ul>');
for(a=0;a<m;a++){e=c.feed.entry[a].gphoto$id.$t;A==e&&(x=a+1);B(c.feed.entry[a].media$group.media$thumbnail[0].url.replace(/\/s72\//,"/s74-c/"),c.feed.entry[a].summary.$t,a+1,e,C);var e=c.feed.entry[a].exif$tags,i=[];e.exif$model&&i.push(e.exif$model.$t);e.exif$fstop&&i.push("F/"+e.exif$fstop.$t);if(e.exif$exposure){var d=parseFloat(e.exif$exposure.$t);d<1&&(d="1/"+Math.round(1/d));i.push(d+"s")}e.exif$focallength&&i.push(Math.round(e.exif$focallength.$t)+"mm");e.exif$iso&&i.push("ISO"+e.exif$iso.$t);
e.exif$flash&&e.exif$flash.$t=="true"&&i.push("Flash");e.exif$time&&(d=new Date,d.setTime(parseInt(e.exif$time.$t)-288E5),i.push(d.toString()));e=i;D(c.feed.entry[a].media$group.media$thumbnail[0].url.replace(/\/s72\//,"/s"+f.photowidth+"/"),c.feed.entry[a].summary.$t,"",a+1,e,c.feed.entry[a].media$group.media$content[0].width,c.feed.entry[a].media$group.media$content[0].height,E)}}}}function G(a,d){b.ajax({url:"http://api.flickr.com/services/rest/?method=flickr.photosets.getInfo&api_key="+u+"&photoset_id="+
a+"&format=json&nojsoncallback=1",dataType:"json",error:function(){},success:function(a){if(a.photoset.title._content!=""){s=' &gt; <a href="index.html?server=flickr&userid='+g+'" title="'+d+"'s Album\">"+g+"</a> &gt; "+a.photoset.title._content;var c="<h2>"+a.photoset.title._content+"</h2>";b("#gh_tips p").append(s);b(".album").prepend(c)}a.photoset.description._content!=""&&b(".album_intro").html("<p>"+a.photoset.description._content+"</p>")}})}function B(a,d,e,i,l){b(".photo_bar").append('<li id="photo_bar_'+
e+'"><a href="#'+i+'" title="'+d+'" class="unready" hidefocus="true"><img src="images/loading_img_0.gif" alt="'+d+'" /><span>'+e+"</span></a></li>");e==m&&(b(".photo_view").prev(".loading").remove(),b(".photo_preview").show().after('<div class="load_show"><div class="load_bar">loading</div><div class="load_photo"></div></div>'),b(".photo_bar").togglePhotos({defphoto:x,photonum:m,perphotos:Math.floor((f.pagewidth-67)/83)-1}));var k=new Image;k.src=a;k.title=d;k.index=e;k.complete?l.call(k):(k.onload=
function(){l.call(k)},k.onerror=function(){})}function D(a,d,e,i,l,k,j,m){var h="";h+='<li class="photo_item" style="width: '+f.pagewidth+'px;" id="photo_item_'+i+'">';h+='<div class="photo_show"><div class="loading">No: '+i+"</div></div>";h+='<div class="photo_intro">';l!=null&&(h+="<p>"+l.join(", ")+"</p>");d!=""&&(h+="<h3>"+d+"</h3>");h+=e;h+="</div>";h+="</li>";b(".photo_list").append(h);var g=new Image;g.src=a;g.title=d;g.intro=e;g.index=i;g.width=k;g.height=j;g.complete?m.call(g):(g.onload=
function(){m.call(g)},g.onerror=function(){})}function C(){F++;b(".load_bar").width(F*f.pagewidth/m);b(".photo_bar #photo_bar_"+this.index+" img").attr("src",this.src)}function E(){y++;b("#photo_bar_"+this.index+" a").removeClass("unready");b(".load_photo").width(y*f.pagewidth/m);b(".load_bar").text("Loading "+y+"/"+m);b(".photo_list #photo_item_"+this.index+" .photo_show").html('<img src="'+this.src+'" alt="'+this.title+'" title="'+this.title+'" />');y==m&&b(".load_show").remove();this.index==(b(".photo_bar li a.active span").text()||
x)&&b("#photo_item_"+this.index).setHeight()}var f={server:"picasa",photowidth:960,pagewidth:980};d(f.photowidth);b(".theme_item a").each(function(a){b(this).bind("click",function(){b("body").attr("id","theme_"+(a+1));b(this).parent().addClass("active").siblings(".theme_item").removeClass("active");b.cookie("theme_id",a+1,{expires:365});return!1})});var p=3,r=parseInt(b.cookie("theme_id"));r!=null&&r>0&&r<5&&(p=r);b(".theme_item a").eq(p-1).trigger("click");b("noscript").remove();b("a, input, select, button, textarea").live("focus",
function(){b(this).addClass("onfocus")}).live("blur",function(){b(this).removeClass("onfocus")});b(".a_user").each(function(){b(this).bind("focus",function(){b(this).val()==this.defaultValue&&b(this).val("")}).bind("blur",function(){b(this).val()==""&&b(this).val(this.defaultValue)}).bind("keydown",function(a){a.which==13&&b(this).next(".a_go").trigger("click")})});b(".a_go").each(function(){b(this).bind("click",function(){var a=b(this).prev(".a_user")[0].defaultValue,d=b(this).prev().prev(".a_serve").val(),
e=b(this).prev(".a_user").val();e==a||e==""?alert("\u8bf7\u8f93\u5165\u5e10\u53f7\uff01"):window.location.href="index.html?server="+d+"&userid="+e})});var z=0,x=1,m=1,F=0,y=0,A=location.hash.substring(1),g="",h="",s="",u="85e1f9464b6825ee0d17222e8555db86",p=function(){for(var a={},b=location.search.substring(1).split("&"),d=0;d<b.length;d++){var f=b[d].indexOf("=");if(f!=-1){var g=b[d].substring(0,f),f=b[d].substring(f+1);a[g]=unescape(f)}}return a}();if(p.server)f.server=p.server;if(p.userid){g=
p.userid;b(".home,").hide();b("#gh_tips, .theme_album").show();if(p.albumid){r="";switch(f.server){case "flickr":d(640);r="http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key="+u+"&photoset_id="+p.albumid+"&format=json&nojsoncallback=1";break;default:r="https://picasaweb.google.com/data/feed/api/user/"+g+"/albumid/"+p.albumid+"?kind=photo&access=public&alt=json"}q(r)}else{var v="";switch(f.server){case "flickr":d(640);n(g);break;default:v="https://picasaweb.google.com/data/feed/api/user/"+
g+"?kind=album&access=public&alt=json",a(v)}}b(".theme_album a").bind("click",function(){b(".home").slideToggle();return!1})}else b(".album, .album_view, .theme_album").remove(),b(".home").show();document.onkeydown=function(a){a=a||window.event;if(a.ctrlKey)switch(a.keyCode){case 37:b(".leftarrow").trigger("click");break;case 39:b(".rightarrow").trigger("click");break;case 38:b(".photo_bar li a:first").trigger("click");break;case 40:b(".photo_bar li a:last").trigger("click")}else switch(a.keyCode){case 37:case 72:b(".photo_prev").trigger("click");
break;case 39:case 76:b(".photo_next").trigger("click");break;case 74:b(".rightarrow").trigger("click");break;case 75:b(".leftarrow").trigger("click")}}});
jQuery.cookie=function(b,d,a){if(arguments.length>1&&(d===null||typeof d!=="object")){a=jQuery.extend({},a);if(d===null)a.expires=-1;if(typeof a.expires==="number"){var q=a.expires,n=a.expires=new Date;n.setDate(n.getDate()+q)}return document.cookie=[encodeURIComponent(b),"=",a.raw?String(d):encodeURIComponent(String(d)),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}a=d||{};n=a.raw?function(a){return a}:
decodeURIComponent;return(q=RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)").exec(document.cookie))?n(q[1]):null};
(function(b){b.fn.listHeight=function(){return this.each(function(){var d=0;b(this).children().each(function(){d=b(this).height()>d?b(this).height():d});b(this).children().height(d)})};b.fn.togglePhotos=function(d){var a={defphoto:1,photonum:0,photowidth:83,perphotos:10,movespeed:1E3,prevbtn:".leftarrow",nextbtn:".rightarrow",prevclass:"prevarrow",nextclass:"nextarrow",prevdiv:".photo_prev",nextdiv:".photo_next",fadeinspeed:400,fadeoutspeed:1E3,clicktag:"li a",itemsid:"#photo_item_",parentdiv:".album",
activeclass:"active",setevent:"click"};return this.each(function(){function q(b){t.stop(!0,!0).animate({left:-(b-1)*a.photowidth*a.perphotos},a.movespeed);o=b;n()}function n(){o>1?b(a.prevbtn).addClass(a.prevclass):b(a.prevbtn).removeClass(a.prevclass);o<w?b(a.nextbtn).addClass(a.nextclass):b(a.nextbtn).removeClass(a.nextclass)}d&&b.extend(a,d);var l=a.defphoto,w=Math.ceil(a.photonum/a.perphotos),o=Math.ceil(a.defphoto/a.perphotos);n();b(this).css("left","-"+a.photowidth*a.perphotos*(o-1)+"px");var t=
b(this);b(a.nextbtn).bind(a.setevent,function(){o<w&&q(o+1);return!1});b(a.prevbtn).bind(a.setevent,function(){o>1&&q(o-1);return!1});b(a.nextdiv).bind(a.setevent,function(){l<a.photonum&&t.find(a.clicktag+":eq("+l+")").trigger(a.setevent)});b(a.prevdiv).bind(a.setevent,function(){l>1&&t.find(a.clicktag+":eq("+(l-2)+")").trigger(a.setevent)});b(this).find(a.clicktag).each(function(){b(this).bind(a.setevent,function(){var d=b(this);l=b(this).children("span").text();var n=Math.ceil(l/a.perphotos);n!=
o&&q(n);n=b(this).parents(a.parentdiv).find(a.itemsid+l);n.siblings().stop(!0,!0).fadeOut(a.fadeinspeed);n.stop(!0,!0).fadeIn(a.fadeoutspeed).setHeight();l>1?b(a.prevdiv).show("fast",function(){var a=d.parent().prev().children().attr("href");b(this).attr("href",a)}):b(a.prevdiv).hide();l<a.photonum?b(a.nextdiv).show("fast",function(){var a=d.parent().next().children().attr("href");b(this).attr("href",a)}):b(a.nextdiv).hide();b(this).addClass(a.activeclass).parent().siblings().children().removeClass(a.activeclass)})});
b(this).find(a.clicktag+":eq("+(a.defphoto-1)+")").trigger(a.setevent)})};b.fn.setHeight=function(){return this.each(function(){var d=b(this);b(this).parent().stop(!0,!0).animate({height:d.height()});b(".photo_prev, .photo_next").height(d.find(".photo_show").height())})}})(jQuery);